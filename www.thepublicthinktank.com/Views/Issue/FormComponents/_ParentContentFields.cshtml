@using atlas_the_public_think_tank.Models.ViewModel.AjaxVM
@using atlas_the_public_think_tank.Models.ViewModel.UI_VM.FormComponentVM
@model Issue_CreateOrEdit_AjaxVM

<fieldset style="all:revert" class="parent-fieldset">
    <legend style="all:revert">Create issue as sub-issue <small><i>(Optional)</i></small></legend>

    @if (Model.Issue.ParentSolution == null)
    {
        List<object> issueIdList = new List<object>();
        string? selectedParentIssueValue = null;
        if (Model.Issue.ParentIssue != null)
        {
            issueIdList.Add(Model.Issue.ParentIssue);
            selectedParentIssueValue = Model.Issue.ParentIssue.IssueID.ToString();

        }

        <div class="parentIssueSelectContainer">


        @await Html.PartialAsync("~/Views/Shared/FormComponents/FormSelect.cshtml",
                    new FormSelectVM()
                {
                    Model = Model.Issue.ParentIssue,
                    FieldLabel = "Parent Issue",
                    FieldPlaceholder = "-- Select a Parent Issue --",
                    PropertyName = "ParentIssueID",
                    TextField = "Title",
                    ValueField = "IssueID",
                    DisabledField = selectedParentIssueValue != null ? true : false,
                    ListItems = issueIdList,
                    SelectedValue = selectedParentIssueValue,
                    Select2ConfigurationCallback = "getParentIssueSelect2Config",
                    Select2ListenerCallback = "setParentIssueSelect2Listener"
                })

        </div>

    }

    @if (Model.Issue.ParentIssue == null)
    {
        List<object> solutionIdList = new List<object>();
        string? selectedParentSolutionValue = null;
        if (Model.Issue.ParentSolution != null)
        {
            solutionIdList.Add(Model.Issue.ParentSolution);
            selectedParentSolutionValue = Model.Issue.ParentSolution.SolutionID.ToString();
        }
        <div class="parentSolutionSelectContainer">

        @await Html.PartialAsync("~/Views/Shared/FormComponents/FormSelect.cshtml",
        new FormSelectVM()
        {
            Model = Model.Issue.ParentSolution,
            FieldLabel = "Parent Solution",
            FieldPlaceholder = "-- Select a Parent Solution--",
            PropertyName = "ParentSolutionID",
            TextField = "Title",
            ValueField = "SolutionID",
            ListItems = solutionIdList,
            SelectedValue = selectedParentSolutionValue,
            DisabledField = selectedParentSolutionValue != null ? true : false,
            Select2ConfigurationCallback = "getParentSolutionSelect2Config",
            Select2ListenerCallback = "setParentSolutionSelect2Listener"
        })
        </div>
    }
</fieldset>
